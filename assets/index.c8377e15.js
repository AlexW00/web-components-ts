var _=Object.defineProperty;var C=(o,e,t)=>e in o?_(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>(C(o,typeof e!="symbol"?e+"":e,t),t);const S=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}};S();class x extends HTMLElement{constructor(t,s){super();r(this,"html");r(this,"css");this.html=t!=null?t:"",this.css=s!=null?s:"",this.attachShadow({mode:"open"})}notifyAll(t,s){const n=new CustomEvent(t,{detail:s});this.dispatchEvent(n)}get root(){if(this.shadowRoot)return this.shadowRoot;throw new Error("WebComponent.root is not available yet")}select(t){return this.root.querySelector(t)}selectAll(t){return this.root.querySelectorAll(t)}async connectedCallback(){this.loadStylesheet(),this.loadHtml(),this.onConnected()}loadStylesheet(){if(this.css!==""){const t=document.createElement("style");t.innerHTML=this.css,this.root.appendChild(t)}}loadHtml(){if(this.html!==""){const t=document.createElement("template");t.innerHTML=this.html,this.root.appendChild(t.content.cloneNode(!0))}}}const w=`p{display:inline-block;color:#ff871e}.red{color:red}.containter{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
`,T=`<div class="red containter">
	<h1></h1>
	<div>Count: <span id="count">0</span></div>
	<button>Click here!</button>
</div>
`;class p extends x{constructor(t){super(T,w);r(this,"exampleState");r(this,"onButtonClicked",()=>{this.exampleState.value.count++});r(this,"onViewModelChanged",t=>{this.select("#count").innerHTML=`${this.exampleState.value.count}`,console.log("COMPONENT ViewModel changed:",t)});this.exampleState=t}get htmlTagName(){return"example-component"}onConnected(){this.root.querySelector("h1").innerHTML=`Hello ${this.exampleState.value.name}!`,this.select("#count").innerHTML=`${this.exampleState.value.count}`,this.select("button").addEventListener("click",this.onButtonClicked),this.exampleState.addEventListener("change",this.onViewModelChanged)}}const A=Object.freeze(Object.defineProperty({__proto__:null,default:p},Symbol.toStringTag,{value:"Module"})),M="modulepreload",b=function(o){return"/web-components-ts/"+o},m={},L=function(e,t,s){return!t||t.length===0?e():Promise.all(t.map(n=>{if(n=b(n),n in m)return;m[n]=!0;const i=n.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${l}`))return;const a=document.createElement("link");if(a.rel=i?"stylesheet":M,i||(a.as="script",a.crossOrigin=""),a.href=n,document.head.appendChild(a),i)return new Promise((g,v)=>{a.addEventListener("load",g),a.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())},f=class{static async loadAll(){const e=Object.assign({"../../components/ExampleComponent/ExampleComponent.ts":()=>L(()=>Promise.resolve().then(()=>A),void 0)}),t=Object.keys(e);for(const s of t){const i=(await e[s]()).default;if(i&&i.prototype.htmlTagName){const l=new N(i.prototype.htmlTagName,i);f.addComponentDefinition(l)}}f.defineAll()}static addComponentDefinition(e){this.componentDefinitions.push(e)}static defineAll(){this.componentDefinitions.forEach(e=>e.defineSelf())}};let u=f;r(u,"componentDefinitions",[]);class N{constructor(e,t){this.name=e,this.componentConstructor=t}defineSelf(){customElements.define(this.name,this.componentConstructor)}}class P{constructor(e,t){r(this,"type");r(this,"data");this.type=e,this.data=t,Object.freeze(this)}}class H{constructor(){r(this,"listener",{})}addEventListener(e,t){this.listener[e]===void 0&&(this.listener[e]=[]),this.listener[e].push(t)}removeEventListener(e,t){if(this.listener[e]!==void 0){for(let s=0;s<this.listener[e].length;s++)if(this.listener[e][s]===t){this.listener[e].splice(s,1);return}}}notifyAll(e,t){const s=new P(e,t);if(this.listener[s.type]!==void 0)for(let n=0;n<this.listener[s.type].length;n++)this.listener[s.type][n](s)}clear(){this.listener={}}}const d=class extends H{constructor(t){super();r(this,"_value");r(this,"_id","");r(this,"_proxyHandler",{set:(t,s,n)=>(t[s]!==n&&(t[s]=n,this.notifyAll(d.STATE_CHANGE_EVENT,n)),!0),get:(t,s)=>{if(s=="isProxy")return!0;const n=t[s];if(!(typeof n>"u"))return!n.isProxy&&typeof n=="object"?this._createProxy(n):n}});this._generateId(),this._setValue(t)}_setValue(t){this._value=typeof t=="object"?this._createProxy(t):t}_createProxy(t){return new Proxy(t,this._proxyHandler)}get value(){return this._value}set value(t){this._setValue(t),this.notifyAll(d.STATE_CHANGE_EVENT,this)}_generateId(){const t=this.constructor.name;let s=d._stateCounts.get(t);s===void 0&&(s=0),d._stateCounts.set(t,s+1),this._id=t+"-"+s,Object.freeze(this._id)}get id(){return this._id}};let c=d;r(c,"STATE_CHANGE_EVENT","change"),r(c,"_stateCounts",new Map);class O{constructor(){r(this,"_state")}toState(){return this._state||(this._state=new c(this)),this._state}}class y extends O{constructor(t,s){super();r(this,"name");r(this,"count");this.name=t,this.count=s}}class E{static async init(){}static async getExampleModel(){return new y("John",0)}}class h{static async init(){const e=await E.getExampleModel();this.addState(e.toState())}static addState(e){this._states.set(e.id,e)}static getStateById(e){return this._states.get(e)}static findState(e,t){for(const s of this._states.values())if(s.value instanceof t&&e(s.value))return s}static findStates(e,t){const s=[];for(const n of this._states.values())n.value instanceof t&&e(n.value)&&s.push(n);return s}}r(h,"_states",new Map);u.loadAll().then(()=>E.init()).then(()=>h.init()).then(()=>V());function V(){const o=h.findState(t=>t.name==="John",y),e=new p(o);document.querySelector("#app").append(e),o.addEventListener(c.STATE_CHANGE_EVENT,t=>{console.log("MAIN ViewModel changed:",t),console.log(h)})}
