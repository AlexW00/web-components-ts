var _=Object.defineProperty;var C=(i,e,t)=>e in i?_(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var r=(i,e,t)=>(C(i,typeof e!="symbol"?e+"":e,t),t);const S=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}};S();class x extends HTMLElement{constructor(t,n){super();r(this,"html");r(this,"css");this.html=t!=null?t:"",this.css=n!=null?n:"",this.attachShadow({mode:"open"})}notifyAll(t,n){const s=new CustomEvent(t,{detail:n});this.dispatchEvent(s)}get root(){if(this.shadowRoot)return this.shadowRoot;throw new Error("WebComponent.root is not available yet")}select(t){return this.root.querySelector(t)}selectAll(t){return this.root.querySelectorAll(t)}async connectedCallback(){this.loadStylesheet(),this.loadHtml(),this.onConnected()}loadStylesheet(){if(this.css!==""){const t=document.createElement("style");t.innerHTML=this.css,this.root.appendChild(t)}}loadHtml(){if(this.html!==""){const t=document.createElement("template");t.innerHTML=this.html,this.root.appendChild(t.content.cloneNode(!0))}}}const w=`p{display:inline-block;color:#ff871e}.red{color:red}.containter{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
`,T=`<div class="red containter">
	<h1></h1>
	<div>Count: <span id="count">0</span></div>
	<button>Click here!</button>
</div>
`;class p extends x{constructor(t){super(T,w);r(this,"exampleState");r(this,"onButtonClicked",()=>{this.exampleState.value.count++});r(this,"onViewModelChanged",t=>{this.select("#count").innerHTML=`${this.exampleState.value.count}`,console.log("COMPONENT ViewModel changed:",t)});this.exampleState=t}get htmlTagName(){return"example-component"}onConnected(){this.root.querySelector("h1").innerHTML=`Hello ${this.exampleState.value.name}!`,this.select("#count").innerHTML=`${this.exampleState.value.count}`,this.select("button").addEventListener("click",this.onButtonClicked),this.exampleState.addEventListener("change",this.onViewModelChanged)}}const A=Object.freeze(Object.defineProperty({__proto__:null,default:p},Symbol.toStringTag,{value:"Module"})),M="modulepreload",b=function(i){return"/web-components-ts/"+i},m={},L=function(e,t,n){return!t||t.length===0?e():Promise.all(t.map(s=>{if(s=b(s),s in m)return;m[s]=!0;const o=s.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${l}`))return;const a=document.createElement("link");if(a.rel=o?"stylesheet":M,o||(a.as="script",a.crossOrigin=""),a.href=s,document.head.appendChild(a),o)return new Promise((g,v)=>{a.addEventListener("load",g),a.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())},f=class{static async loadAll(){const e=Object.assign({"../../components/ExampleComponent/ExampleComponent.ts":()=>L(()=>Promise.resolve().then(()=>A),void 0)}),t=Object.keys(e);for(const n of t){const o=(await e[n]()).default;if(o&&o.prototype.htmlTagName){const l=new N(o.prototype.htmlTagName,o);f.addComponentDefinition(l)}}f.defineAll()}static addComponentDefinition(e){this.componentDefinitions.push(e)}static defineAll(){this.componentDefinitions.forEach(e=>e.defineSelf())}};let u=f;r(u,"componentDefinitions",[]);class N{constructor(e,t){this.name=e,this.componentConstructor=t}defineSelf(){customElements.define(this.name,this.componentConstructor)}}class P{constructor(e,t){r(this,"type");r(this,"data");this.type=e,this.data=t,Object.freeze(this)}}class H{constructor(){r(this,"listener",{})}addEventListener(e,t){this.listener[e]===void 0&&(this.listener[e]=[]),this.listener[e].push(t)}removeEventListener(e,t){if(this.listener[e]!==void 0){for(let n=0;n<this.listener[e].length;n++)if(this.listener[e][n]===t){this.listener[e].splice(n,1);return}}}notifyAll(e,t){const n=new P(e,t);if(this.listener[n.type]!==void 0)for(let s=0;s<this.listener[n.type].length;s++)this.listener[n.type][s](n)}clear(){this.listener={}}}const d=class extends H{constructor(t){super();r(this,"_value");r(this,"_id","");r(this,"_proxyHandler",{set:(t,n,s)=>(t[n]!==s&&(t[n]=s,this.notifyAll(d.STATE_CHANGE_EVENT,s)),!0),get:(t,n)=>{if(n=="isProxy")return!0;const s=t[n];if(!(typeof s>"u"))return!s.isProxy&&typeof s=="object"?this._createProxy(s):s}});this._generateId(),this._setValue(t)}_setValue(t){this._value=typeof t=="object"?this._createProxy(t):t}_createProxy(t){return new Proxy(t,this._proxyHandler)}get value(){return this._value}set value(t){this._setValue(t),this.notifyAll(d.STATE_CHANGE_EVENT,this)}_generateId(){const t=this.constructor.name;let n=d._stateCounts.get(t);n===void 0&&(n=0),d._stateCounts.set(t,n+1),this._id=t+"-"+n,Object.freeze(this._id)}get id(){return this._id}};let c=d;r(c,"STATE_CHANGE_EVENT","change"),r(c,"_stateCounts",new Map);class O{constructor(){r(this,"_state")}toState(){return this._state||(this._state=new c(this)),this._state}}class y extends O{constructor(t,n){super();r(this,"name");r(this,"count");this.name=t,this.count=n}}class E{static async init(){}static async getExampleModel(){return new y("John",0)}}class h{static async init(){const e=await E.getExampleModel();this.addState(e.toState())}static addState(e){this._states.set(e.id,e)}static getStateById(e){return this._states.get(e)}static findState(e,t){for(const n of this._states.values())if(n.value instanceof t&&e(n.value))return n}static findStates(e,t){const n=[];for(const s of this._states.values())s.value instanceof t&&e(s.value)&&n.push(s);return n}}r(h,"_states",new Map);const V=()=>{u.loadAll().then(()=>E.init()).then(()=>h.init()).then(()=>i());function i(){const e=h.findState(n=>n.name==="John",y),t=new p(e);document.querySelector("#app").append(t),e.addEventListener(c.STATE_CHANGE_EVENT,n=>{console.log("MAIN ViewModel changed:",n),console.log(h)})}};V();
